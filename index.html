<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Visualisasi Konsep Matematika</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  </head>
  <body class="bg-gray-100 min-h-screen p-4 md:p-8">
    <div class="max-w-6xl mx-auto bg-white rounded-xl shadow-lg p-6">
      <h1 class="text-3xl font-bold text-center text-gray-800 mb-2">Visualisasi Konsep Matematika</h1>
      <p class="text-center text-gray-600 mb-6">Garis Singgung, Kecepatan Sesaat, Kemonotonan, dan Kecekungan</p>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Panel Kontrol -->
        <div class="lg:col-span-1 bg-gray-50 p-4 rounded-lg">
          <h2 class="text-xl font-semibold mb-4 text-gray-700">Pengaturan Fungsi</h2>

          <!-- Pilihan Jenis Fungsi -->
          <div class="mb-6">
            <h3 class="font-medium text-gray-700 mb-2">Jenis Fungsi</h3>
            <select id="functionType" class="w-full p-2 border rounded bg-white">
              <option value="polynomial">Polinomial (ax² + bx + c)</option>
              <option value="sinus">Sinus (a sin(bx))</option>
              <option value="exponential">Eksponensial (a e^(bx))</option>
              <option value="logarithm">Logaritma (a ln(bx))</option>
            </select>
          </div>

          <!-- Parameter Fungsi -->
          <div class="mb-6">
            <h3 class="font-medium text-gray-700 mb-2">Parameter Fungsi</h3>
            <div id="functionParams" class="space-y-3">
              <!-- Parameter Polinomial -->
              <div class="function-param polynomial">
                <label class="block text-sm text-gray-600 mb-1">Koefisien x² (a)</label>
                <input type="range" min="-5" max="5" value="1" step="0.1" id="polyA" class="w-full" />
                <div class="flex justify-between text-xs text-gray-500">
                  <span>-5</span>
                  <span id="polyAValue">1.0</span>
                  <span>5</span>
                </div>
              </div>

              <div class="function-param polynomial">
                <label class="block text-sm text-gray-600 mb-1">Koefisien x (b)</label>
                <input type="range" min="-5" max="5" value="0" step="0.1" id="polyB" class="w-full" />
                <div class="flex justify-between text-xs text-gray-500">
                  <span>-5</span>
                  <span id="polyBValue">0.0</span>
                  <span>5</span>
                </div>
              </div>

              <div class="function-param polynomial">
                <label class="block text-sm text-gray-600 mb-1">Konstanta (c)</label>
                <input type="range" min="-5" max="5" value="0" step="0.1" id="polyC" class="w-full" />
                <div class="flex justify-between text-xs text-gray-500">
                  <span>-5</span>
                  <span id="polyCValue">0.0</span>
                  <span>5</span>
                </div>
              </div>

              <!-- Parameter Sinus -->
              <div class="function-param sinus hidden">
                <label class="block text-sm text-gray-600 mb-1">Amplitudo (a)</label>
                <input type="range" min="-3" max="3" value="1" step="0.1" id="sinA" class="w-full" />
                <div class="flex justify-between text-xs text-gray-500">
                  <span>-3</span>
                  <span id="sinAValue">1.0</span>
                  <span>3</span>
                </div>
              </div>

              <div class="function-param sinus hidden">
                <label class="block text-sm text-gray-600 mb-1">Frekuensi (b)</label>
                <input type="range" min="0.1" max="5" value="1" step="0.1" id="sinB" class="w-full" />
                <div class="flex justify-between text-xs text-gray-500">
                  <span>0.1</span>
                  <span id="sinBValue">1.0</span>
                  <span>5</span>
                </div>
              </div>

              <!-- Parameter Eksponensial -->
              <div class="function-param exponential hidden">
                <label class="block text-sm text-gray-600 mb-1">Koefisien (a)</label>
                <input type="range" min="0.1" max="3" value="1" step="0.1" id="expA" class="w-full" />
                <div class="flex justify-between text-xs text-gray-500">
                  <span>0.1</span>
                  <span id="expAValue">1.0</span>
                  <span>3</span>
                </div>
              </div>

              <div class="function-param exponential hidden">
                <label class="block text-sm text-gray-600 mb-1">Eksponen (b)</label>
                <input type="range" min="-1" max="1" value="0.5" step="0.1" id="expB" class="w-full" />
                <div class="flex justify-between text-xs text-gray-500">
                  <span>-1</span>
                  <span id="expBValue">0.5</span>
                  <span>1</span>
                </div>
              </div>

              <!-- Parameter Logaritma -->
              <div class="function-param logarithm hidden">
                <label class="block text-sm text-gray-600 mb-1">Koefisien (a)</label>
                <input type="range" min="-3" max="3" value="1" step="0.1" id="logA" class="w-full" />
                <div class="flex justify-between text-xs text-gray-500">
                  <span>-3</span>
                  <span id="logAValue">1.0</span>
                  <span>3</span>
                </div>
              </div>

              <div class="function-param logarithm hidden">
                <label class="block text-sm text-gray-600 mb-1">Parameter (b)</label>
                <input type="range" min="0.1" max="3" value="1" step="0.1" id="logB" class="w-full" />
                <div class="flex justify-between text-xs text-gray-500">
                  <span>0.1</span>
                  <span id="logBValue">1.0</span>
                  <span>3</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Titik Garis Singgung -->
          <div class="mb-6">
            <h3 class="font-medium text-gray-700 mb-2">Titik Garis Singgung</h3>
            <div>
              <label class="block text-sm text-gray-600 mb-1">Nilai x</label>
              <input type="range" min="-5" max="5" value="1" step="0.1" id="tangentPoint" class="w-full" />
              <div class="flex justify-between text-xs text-gray-500">
                <span>-5</span>
                <span id="tangentPointValue">1.0</span>
                <span>5</span>
              </div>
            </div>
          </div>

          <!-- Rentang Grafik -->
          <div class="mb-6">
            <h3 class="font-medium text-gray-700 mb-2">Rentang Grafik</h3>
            <div class="grid grid-cols-2 gap-3">
              <div>
                <label class="block text-sm text-gray-600 mb-1">x min</label>
                <input type="number" id="xMin" value="-5" class="w-full p-2 border rounded" />
              </div>
              <div>
                <label class="block text-sm text-gray-600 mb-1">x max</label>
                <input type="number" id="xMax" value="5" class="w-full p-2 border rounded" />
              </div>
            </div>
          </div>

          <!-- Tombol Reset -->
          <button id="resetBtn" class="w-full py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors">Reset ke Default</button>
        </div>

        <!-- Panel Grafik dan Informasi -->
        <div class="lg:col-span-2">
          <!-- Grafik -->
          <div class="bg-white p-4 rounded-lg border border-gray-200 mb-6">
            <div id="chart" class="h-80"></div>
          </div>

          <!-- Informasi Matematika -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <!-- Garis Singgung -->
            <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
              <h3 class="font-semibold text-blue-700 mb-2">Garis Singgung</h3>
              <p id="tangentInfo" class="text-sm text-gray-700">Persamaan: y = x</p>
              <p id="slopeInfo" class="text-sm text-gray-700 mt-1">Kemiringan: 1</p>
            </div>

            <!-- Kemonotonan -->
            <div class="bg-green-50 p-4 rounded-lg border border-green-200">
              <h3 class="font-semibold text-green-700 mb-2">Kemonotonan</h3>
              <p id="monotonicityInfo" class="text-sm text-gray-700">Fungsi naik di sekitar titik ini</p>
            </div>

            <!-- Kecekungan -->
            <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
              <h3 class="font-semibold text-purple-700 mb-2">Kecekungan</h3>
              <p id="concavityInfo" class="text-sm text-gray-700">Fungsi cekung ke atas di sekitar titik ini</p>
            </div>
          </div>

          <!-- Informasi Fungsi -->
          <div class="mt-6 bg-yellow-50 p-4 rounded-lg border border-yellow-200">
            <h3 class="font-semibold text-yellow-700 mb-2">Informasi Fungsi</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <p class="text-sm text-gray-700"><span class="font-medium">Fungsi:</span> <span id="functionExpression">f(x) = x²</span></p>
                <p class="text-sm text-gray-700 mt-1"><span class="font-medium">Turunan Pertama:</span> <span id="firstDerivative">f'(x) = 2x</span></p>
              </div>
              <div>
                <p class="text-sm text-gray-700"><span class="font-medium">Turunan Kedua:</span> <span id="secondDerivative">f''(x) = 2</span></p>
                <p class="text-sm text-gray-700 mt-1"><span class="font-medium">Nilai di titik x:</span> <span id="functionValue">f(1) = 1</span></p>
              </div>
            </div>
          </div>

          <!-- Penjelasan Konsep -->
          <div class="mt-6 bg-gray-50 p-4 rounded-lg border border-gray-200">
            <h3 class="font-semibold text-gray-700 mb-2">Penjelasan Konsep</h3>
            <ul class="text-sm text-gray-600 space-y-2">
              <li><span class="font-medium">Garis Singgung:</span> Garis yang menyentuh kurva di satu titik tanpa memotongnya.</li>
              <li><span class="font-medium">Kecepatan Sesaat:</span> Nilai turunan pertama di titik tertentu, merepresentasikan kemiringan garis singgung.</li>
              <li><span class="font-medium">Kemonotonan:</span> Menentukan apakah fungsi naik atau turun pada interval tertentu.</li>
              <li><span class="font-medium">Kecekungan:</span> Menentukan arah lengkungan fungsi (cekung ke atas atau ke bawah).</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Inisialisasi variabel
      let chart;
      let functionType = 'polynomial';
      let polyA = 1,
        polyB = 0,
        polyC = 0;
      let sinA = 1,
        sinB = 1;
      let expA = 1,
        expB = 0.5;
      let logA = 1,
        logB = 1;
      let tangentX = 1;
      let xMin = -5,
        xMax = 5;

      // Fungsi matematika
      const functions = {
        polynomial: {
          f: (x) => polyA * x * x + polyB * x + polyC,
          fPrime: (x) => 2 * polyA * x + polyB,
          fDoublePrime: (x) => 2 * polyA,
          expression: () => {
            let expr = '';
            if (polyA !== 0) expr += `${polyA}x²`;
            if (polyB !== 0) expr += (polyB > 0 && expr !== '' ? ' + ' : '') + (polyB === 1 ? 'x' : polyB === -1 ? '-x' : `${polyB}x`);
            if (polyC !== 0) expr += (polyC > 0 && expr !== '' ? ' + ' : '') + polyC;
            return expr || '0';
          },
          firstDerivative: () => {
            let expr = '';
            if (2 * polyA !== 0) expr += `${2 * polyA}x`;
            if (polyB !== 0) expr += (polyB > 0 && expr !== '' ? ' + ' : '') + polyB;
            return expr || '0';
          },
          secondDerivative: () => `${2 * polyA}`,
        },
        sinus: {
          f: (x) => sinA * Math.sin(sinB * x),
          fPrime: (x) => sinA * sinB * Math.cos(sinB * x),
          fDoublePrime: (x) => -sinA * sinB * sinB * Math.sin(sinB * x),
          expression: () => `${sinA} sin(${sinB}x)`,
          firstDerivative: () => `${sinA * sinB} cos(${sinB}x)`,
          secondDerivative: () => `-${sinA * sinB * sinB} sin(${sinB}x)`,
        },
        exponential: {
          f: (x) => expA * Math.exp(expB * x),
          fPrime: (x) => expA * expB * Math.exp(expB * x),
          fDoublePrime: (x) => expA * expB * expB * Math.exp(expB * x),
          expression: () => `${expA} e^(${expB}x)`,
          firstDerivative: () => `${expA * expB} e^(${expB}x)`,
          secondDerivative: () => `${expA * expB * expB} e^(${expB}x)`,
        },
        logarithm: {
          f: (x) => {
            if (logB * x <= 0) return NaN;
            return logA * Math.log(logB * x);
          },
          fPrime: (x) => {
            if (logB * x <= 0) return NaN;
            return (logA * logB) / (logB * x);
          },
          fDoublePrime: (x) => {
            if (logB * x <= 0) return NaN;
            return (-logA * logB * logB) / (logB * x * logB * x);
          },
          expression: () => `${logA} ln(${logB}x)`,
          firstDerivative: () => `${logA}/${logB}x`,
          secondDerivative: () => `-${logA}/(${logB}x)²`,
        },
      };

      // Fungsi untuk memperbarui tampilan
      function updateValues() {
        functionType = document.getElementById('functionType').value;

        // Perbarui nilai parameter berdasarkan jenis fungsi
        if (functionType === 'polynomial') {
          polyA = parseFloat(document.getElementById('polyA').value);
          polyB = parseFloat(document.getElementById('polyB').value);
          polyC = parseFloat(document.getElementById('polyC').value);

          document.getElementById('polyAValue').textContent = polyA.toFixed(1);
          document.getElementById('polyBValue').textContent = polyB.toFixed(1);
          document.getElementById('polyCValue').textContent = polyC.toFixed(1);
        } else if (functionType === 'sinus') {
          sinA = parseFloat(document.getElementById('sinA').value);
          sinB = parseFloat(document.getElementById('sinB').value);

          document.getElementById('sinAValue').textContent = sinA.toFixed(1);
          document.getElementById('sinBValue').textContent = sinB.toFixed(1);
        } else if (functionType === 'exponential') {
          expA = parseFloat(document.getElementById('expA').value);
          expB = parseFloat(document.getElementById('expB').value);

          document.getElementById('expAValue').textContent = expA.toFixed(1);
          document.getElementById('expBValue').textContent = expB.toFixed(1);
        } else if (functionType === 'logarithm') {
          logA = parseFloat(document.getElementById('logA').value);
          logB = parseFloat(document.getElementById('logB').value);

          document.getElementById('logAValue').textContent = logA.toFixed(1);
          document.getElementById('logBValue').textContent = logB.toFixed(1);
        }

        tangentX = parseFloat(document.getElementById('tangentPoint').value);
        document.getElementById('tangentPointValue').textContent = tangentX.toFixed(1);

        // Perbarui rentang grafik
        xMin = parseFloat(document.getElementById('xMin').value);
        xMax = parseFloat(document.getElementById('xMax').value);

        updateAnalysis();
        updateChart();
      }

      // Memperbarui analisis
      function updateAnalysis() {
        const func = functions[functionType];
        const fx = func.f(tangentX);
        const fpx = func.fPrime(tangentX);
        const fdpx = func.fDoublePrime(tangentX);

        // Perbarui informasi fungsi
        document.getElementById('functionExpression').textContent = `f(x) = ${func.expression()}`;
        document.getElementById('firstDerivative').textContent = `f'(x) = ${func.firstDerivative()}`;
        document.getElementById('secondDerivative').textContent = `f''(x) = ${func.secondDerivative()}`;
        document.getElementById('functionValue').textContent = `f(${tangentX.toFixed(1)}) = ${isNaN(fx) ? 'Tidak terdefinisi' : fx.toFixed(2)}`;

        // Persamaan garis singgung
        if (!isNaN(fx) && !isNaN(fpx)) {
          const tangentIntercept = fx - fpx * tangentX;
          let tangentLine = '';
          if (fpx !== 0) {
            tangentLine = `${fpx.toFixed(2)}x ${tangentIntercept >= 0 ? '+' : '-'} ${Math.abs(tangentIntercept).toFixed(2)}`;
          } else {
            tangentLine = `${fx.toFixed(2)}`;
          }
          document.getElementById('tangentInfo').textContent = `Persamaan: y = ${tangentLine}`;
          document.getElementById('slopeInfo').textContent = `Kemiringan: ${fpx.toFixed(2)}`;
        } else {
          document.getElementById('tangentInfo').textContent = 'Garis singgung tidak terdefinisi';
          document.getElementById('slopeInfo').textContent = 'Kemiringan: -';
        }

        // Kemonotonan
        const monotonicityElement = document.getElementById('monotonicityInfo');
        if (!isNaN(fpx)) {
          if (fpx > 0) {
            monotonicityElement.textContent = 'Fungsi naik di sekitar titik ini';
            monotonicityElement.className = 'text-sm text-green-700 mt-1';
          } else if (fpx < 0) {
            monotonicityElement.textContent = 'Fungsi turun di sekitar titik ini';
            monotonicityElement.className = 'text-sm text-red-700 mt-1';
          } else {
            monotonicityElement.textContent = 'Fungsi stasioner di titik ini';
            monotonicityElement.className = 'text-sm text-yellow-700 mt-1';
          }
        } else {
          monotonicityElement.textContent = 'Kemonotonan tidak terdefinisi';
          monotonicityElement.className = 'text-sm text-gray-700 mt-1';
        }

        // Kecekungan
        const concavityElement = document.getElementById('concavityInfo');
        if (!isNaN(fdpx)) {
          if (fdpx > 0) {
            concavityElement.textContent = 'Fungsi cekung ke atas di sekitar titik ini';
            concavityElement.className = 'text-sm text-purple-700 mt-1';
          } else if (fdpx < 0) {
            concavityElement.textContent = 'Fungsi cekung ke bawah di sekitar titik ini';
            concavityElement.className = 'text-sm text-purple-700 mt-1';
          } else {
            concavityElement.textContent = 'Tidak ada kecekungan di titik ini';
            concavityElement.className = 'text-sm text-gray-700 mt-1';
          }
        } else {
          concavityElement.textContent = 'Kecekungan tidak terdefinisi';
          concavityElement.className = 'text-sm text-gray-700 mt-1';
        }
      }

      // Memperbarui grafik
      function updateChart() {
        const func = functions[functionType];

        // Data untuk fungsi utama
        const data = [];
        const step = (xMax - xMin) / 200;

        for (let x = xMin; x <= xMax; x += step) {
          const y = func.f(x);
          if (!isNaN(y) && isFinite(y)) {
            data.push({
              x: x,
              y: y,
            });
          }
        }

        // Data untuk garis singgung
        const tangentData = [];
        const fx = func.f(tangentX);
        const fpx = func.fPrime(tangentX);

        if (!isNaN(fx) && !isNaN(fpx)) {
          // Rentang garis singgung (2 satuan di kiri dan kanan titik)
          const tangentRange = 2;
          const tangentStep = (2 * tangentRange) / 20;

          for (let x = tangentX - tangentRange; x <= tangentX + tangentRange; x += tangentStep) {
            const y = fpx * (x - tangentX) + fx;
            if (!isNaN(y) && isFinite(y)) {
              tangentData.push({
                x: x,
                y: y,
              });
            }
          }
        }

        // Konfigurasi ApexCharts
        const options = {
          series: [
            {
              name: `Fungsi f(x) = ${func.expression()}`,
              data: data,
              type: 'line',
            },
            {
              name: 'Garis Singgung',
              data: tangentData,
              type: 'line',
            },
            {
              name: 'Titik Analisis',
              data: !isNaN(fx) && isFinite(fx) ? [{ x: tangentX, y: fx }] : [],
              type: 'scatter',
            },
          ],
          chart: {
            height: '100%',
            type: 'line',
            zoom: {
              enabled: false,
            },
            animations: {
              enabled: true,
              easing: 'linear',
              dynamicAnimation: {
                speed: 500,
              },
            },
            toolbar: {
              show: false,
            },
          },
          colors: ['#3b82f6', '#ef4444', '#10b981'],
          stroke: {
            width: [3, 2, 0],
            dashArray: [0, 5, 0],
          },
          markers: {
            size: [0, 0, 6],
            colors: ['#10b981'],
          },
          xaxis: {
            type: 'numeric',
            min: xMin,
            max: xMax,
            tickAmount: 10,
            labels: {
              formatter: function (val) {
                return val.toFixed(1);
              },
            },
          },
          yaxis: {
            tickAmount: 10,
            labels: {
              formatter: function (val) {
                return val.toFixed(1);
              },
            },
          },
          tooltip: {
            shared: true,
            intersect: false,
            x: {
              formatter: function (val) {
                return 'x: ' + val.toFixed(2);
              },
            },
          },
          legend: {
            position: 'top',
            horizontalAlign: 'center',
          },
          grid: {
            borderColor: '#e7e7e7',
            row: {
              colors: ['#f3f4f6', 'transparent'],
              opacity: 0.5,
            },
          },
        };

        // Render atau perbarui grafik
        if (!chart) {
          chart = new ApexCharts(document.querySelector('#chart'), options);
          chart.render();
        } else {
          chart.updateOptions(options);
        }
      }

      // Fungsi untuk menampilkan parameter yang sesuai
      function showFunctionParams() {
        const functionType = document.getElementById('functionType').value;

        // Sembunyikan semua parameter
        document.querySelectorAll('.function-param').forEach((param) => {
          param.classList.add('hidden');
        });

        // Tampilkan parameter yang sesuai
        document.querySelectorAll(`.function-param.${functionType}`).forEach((param) => {
          param.classList.remove('hidden');
        });

        updateValues();
      }

      // Event listeners
      document.getElementById('functionType').addEventListener('change', showFunctionParams);

      // Event listeners untuk slider
      document.querySelectorAll('input[type="range"]').forEach((slider) => {
        slider.addEventListener('input', updateValues);
      });

      // Event listeners untuk rentang grafik
      document.getElementById('xMin').addEventListener('change', updateValues);
      document.getElementById('xMax').addEventListener('change', updateValues);

      // Event listener untuk tombol reset
      document.getElementById('resetBtn').addEventListener('click', function () {
        document.getElementById('functionType').value = 'polynomial';

        // Reset nilai default untuk setiap fungsi
        document.getElementById('polyA').value = 1;
        document.getElementById('polyB').value = 0;
        document.getElementById('polyC').value = 0;

        document.getElementById('sinA').value = 1;
        document.getElementById('sinB').value = 1;

        document.getElementById('expA').value = 1;
        document.getElementById('expB').value = 0.5;

        document.getElementById('logA').value = 1;
        document.getElementById('logB').value = 1;

        document.getElementById('tangentPoint').value = 1;
        document.getElementById('xMin').value = -5;
        document.getElementById('xMax').value = 5;

        showFunctionParams();
      });

      // Inisialisasi
      showFunctionParams();
    </script>
  </body>
</html>
